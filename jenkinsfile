import jenkins.scm.api.SCMSource

public String descriptionFor(SCMSource source) {
    String action = getPayload().getAction();
    if (action == "closed") {
        return "Pull request #" + getPayload().getNumber() + " closed";
    }
    else {
        currentBuild.result = 'ABORTED'
    }
    return "Pull request #" + getPayload().getNumber() + " event";
}

pipeline {
    agent any
    stages {
        stage('Test1') {
             steps {
                   echo "+ Job has been runned        "
		   PR = sh(returnStdout: true, script: "gh api --jq .[].number /repos/ivngmz/jenkins/commits/$GIT_COMMIT/pulls ")
                    echo "+ PR number -> $PR" 

                    if (PR != ''){

                        status_PR = sh(returnStdout: true, script: "gh api --jq .state /repos/ivngmz/jenkins/pulls/${PR} ")
                        echo "++ Current PR status -> $status_PR"

                        // Only merged PR will be checked
                        if (status_PR == "MERGED") {
                            labels = sh(returnStdout: true, script: "gh api --jq '.labels.[].name' /repos/ivngmz/jenkins/pulls/${PR}")
                            echo "++ Found label:${labels}"
						   }
				}  
                }
        }
    }
}
